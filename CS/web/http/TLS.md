# TLS

Transport Layer Security，传输层安全协议是一种安全协议，其目的是为互联网通信提供安全及数据完整性保证。

==TLS是IEFT将SSL进行标准化的产物。==

### 概论

TLS协议用于在两个应用程序间透过网络创建起安全的连接，防止在交换数据时被窃听以及篡改。

应用层协议能够透明地允许在TLS协议上，应用层协议传输的数据在通过TLS协议时都会被加密，从而保证通信的私密性。

### TLS协商过程

![](https://markdown-1259282458.cos.ap-nanjing.myqcloud.com/img/20210731230541.png)

Step 1～3 为TCP连接建立过程。

Step 4～6为TLS协商过程。

- Step4 ：客户端请求开始协商过程，TLS握手开始
- Step5：服务器向客户端发送其数字证书，证书通常包含服务器名称，受信任的证书颁发中心(CA)和服务器公钥。
- Step6：客户端验证服务器证书的有效性，然后生成一个作为对称加密的密钥的随机数，使用从证书中获取的服务器公钥进行加密。将加密后的消息发送给服务器。服务器用其私钥进行解密得到对称加密的密钥。 至此协商完成，可以进行安全通话。

##### 证书验证

数字签名是在非对称加密中使用私钥对信息进行签名。要对签名进行验证需要使用到该对象的公钥。数字证书就是CA对证书进行了数字签名。因此要进行数字证书有效性验证就需要使用CA的公钥。而取得CA的公钥就需要获取CA的证书。

这就产生了一个循环验证的问题，要解决这个问题，就需要有一个可以永远信任的证书。即根证书。

![](https://markdown-1259282458.cos.ap-nanjing.myqcloud.com/img/20210731224654.png)

通过根证书的验证，最终保证证书的有效性，保证传输的安全性。

##### 安全性保证

在未进行TLS协商时，我们只建立了TCP连接，在此时，我们处于一个不安全的连接环境，我们的消息可能被窃听，窜改等。

客户端请求进行TLS协商，服务器发送其证书。

- 若此时证书被篡改，则无法通过验签。
- 若此时证书被替换，则后续服务器无法通过私钥解密秘文，协商失败
- 而窃听者获取服务器证书并无实际意义，因为非对称加密无法通过公钥对密文进行解密。

此时证书到达客户端，形成对称加密密钥后经过公钥加密发送给服务器。

- 若此时密文被窃取，因为无私钥无法进行解密。
- 若此时密文被篡改，则无法进行解密。

综上通信是安全的(建立在非对称加密无法破解的基础上)



---

##### Reference

- [TLS](https://zh.wikipedia.org/wiki/%E5%82%B3%E8%BC%B8%E5%B1%A4%E5%AE%89%E5%85%A8%E6%80%A7%E5%8D%94%E5%AE%9A)

- [HTTPS数字证书与验证](https://www.jianshu.com/p/887859661be6)

