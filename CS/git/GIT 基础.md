## GIT 基础

#### git是什么

git是第三代版本控制系统，是一种分布式版本控制系统。允许在不同地区的人们协同工作，不再像第二代版本控制系统，拥有一个版本库服务器，所有的操作都需要与服务器进行同步。在git中每个人都有一份版本库的完整副本，因此涉及的网络操作比第二代版本控制系统少了很多。

#### `.git`版本库中的主要内容

![](https://markdown-1259282458.cos.ap-nanjing.myqcloud.com/img/20210715211312.png)

---

#### git原理

##### git对象

- blog对象：
  - 用于存储文件内容
  - 存储格式`objects/sha_2/sha_38`
- 树对象：
  - 类似于unix文件系统中的目录
  - 用于解决文件名存放问题
  - 一个树对象中包含了一个后多个记录，记录指向blob对象，或者子树对象
- 提交对象
  - 用于追踪整个分支 ，以及保存提交信息
  - 包含当前提交父提交的指针，以及指向当前提交树对象的指针。
- 标签对象
  - 包含创建者信息，日期， 注释信息，以及一个指针。
  - 在创建后，标签对象永远指向同一个提交对象。
  - 本质上就是给特定提交对象添加一个用户友好的别名。

版本控制系统中，文件的存放以及修改的跟踪是十分关键的，在分布式版本控制系统中，版本的控制并不能才有递增版本号的形式，因为每个用户都有一个完整的版本库，并无法保证版本号独一无二。

git通过保有父节点指针的提交对象来完成版本控制，通过使用单向散列函数SHA1来保证每个提交对象唯一，进而保证版本的唯一性。

git同时也采用文件内容和文件目录信息分开的形式，这样做的好处

- 文件存储
  - git用目录树来存储路径，用blob来存储文件内容，将路径与文件分开，使用单向散列函数来计算blob摘要，以此来判断内容是否相同，进而避免存放重复内容
- 重命名
  - 这样的设计也解决了重命名的问题，重命名只需要对目录树进行改变，而不需要对文件内容进行改变，不需要进行复制
- 比较是否相同时效率更高
  - 使用散列值来比较是否相同，可以避免很多逐行比较

##### 散列值的计算

在计算一个对象的散列值时，git首先会以识别出的对象类型作为开头来构造一个头部信息，接着添加一个空格，然后是一个空字节`\0`，最后加上文件内容，计算出来的sha1值，就是该对象的哈希值。

#### git对象管理

仅仅如此存储文件，还是有一些问题，比如我们存储了一些非常类似的文件，或者对一个大文件进行了很小的改动，如果只是单单使用上面的存储方式，就会浪费许多空间。

因此git在存储上又进行了改进，git最初像磁盘中存储对象的格式被称为松散的对象格式。但是git会时不时的将多个这些对象打包成一个包文件(packfile)的二进制文件，以节省空间以及提高效率。

*当版本库中有过多松散对象，或者手动执行`git gc`,或者向远程服务器执行推送时，git都会进行打包操作*

==打包是通过保存差异实现对空间的节约，git会查找命名及大小相近的文件，将文件的最新版本完整保存，之前的版本通过差异来进行存储。==

#### git引用

git通过创建引用使我们避免记忆冗长的sha1值，能够通过引用获取我们想要的对象。

git的分支本质上就是利用引用，转到不同的节点，在其上进行操作。

##### HEAD引用

HEAD引用是一个符号引用，即指向引用的引用。HEAD永远指向当前检出的分支。

##### 标签引用

git支持两种标签：

- 轻量标签(lightweight)
  - 只是某提交对象的引用，不包含其他信息
- 附注标签(annotated)
  - 会创建一个完整的标签对象

##### 远程引用

如果添加了一个远程版本库，git会将该引用保存到`refs/remote`目录下

如`git remote add origin git@github.com:xxx/xxx.git`

就会添加一个名为origin的远程引用。

#### git 维护与数据恢复

##### 维护

git会不定时自动运行`auto gc`，大多数时候，这个命令并不会有效果。而当版本库中有太多松散对象或者太多包文件，git会运行一个完整的`git gc`命令。

*gc代表垃圾回收，其作用为收集所有松散对象并将它们放置到包文件中，将多个包文件合并为一个大的包文件，移除与任何提交都不想关的陈旧对象以及将引用打包到一个单独的文件*

##### 数据恢复

在使用git时，若意外丢失了一次提交，或使用硬重置`git reset --hard`,放弃了某些提交。而现在你又想找回，又应该怎么办呢



### git 分支

git的分支，其实本质上仅仅是指向提交对象的可变指针。git的版本库的所有提交对象可以构成一颗节点带有父节点的树。而分支则是指向叶的指针。